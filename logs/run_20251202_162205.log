nohup: ignoring input
Crash diagnostics ON


==================================================
PART 1: Data preprocess for 2023-01-01 00:00:00 to 2024-09-30 23:00:00...
==================================================

	1.1 Preprocessing radiation data...
		[INFO] Radiation data already exists at './data/timeseries/radiation_data.csv'

	1.2 Preprocessing temperature data...
		[INFO] Temperature data already exists at './data/timeseries/temperature_data.csv'

	1.3 Preprocessing building data...
		[INFO] Building data already exists at './data/timeseries/building_data.csv'

	1.4 Preprocessing electricity cost data...
		[INFO] Electricity cost data already exists at './data/timeseries/electricitycostG2B_data.csv' and './data/timeseries/electricitycostG2V_data.csv'

	1.5 Preprocessing battery demand series data...
		[INFO] Found existing battery data at 'data/battery_demand/resample_full.csv' and 'data/battery_demand/resample_train.csv'

		[INFO] Number of series for clean windows = (168, 37)
		[INFO] Number of eligible series for Case 2 = (1395, 37)
		[INFO] Case 1 exists — loaded battery demand from 'data/battery_demand/case1_real_only/battery_demand.npy' with shape (168, 37).
		[INFO] Case 2 exists — loaded battery demand from 'data/battery_demand/case2_nan_filled/battery_demand.npy' with shape (1563, 37).
		[INFO] Case 0: Successfully added test pair 2024-03-15 & 2024-03-16
		Data: [10536, 28, 30, 35, 37, 37, 36, 33, 26, 10, 6, 10, 14, 19, 18, 15, 20, 26, 15, 9, 16, 21, 20, 8, 12, 15, 24, 31, 35, 32, 35, 34, 32, 31, 30, 22, 14, 18, 27, 18, 19, 19, 25, 25, 25, 26, 27, 17, 19]
		[INFO] Case 0: Successfully added test pair 2024-03-29 & 2024-03-30
		Data: [10872, 13, 26, 31, 33, 33, 33, 31, 15, 8, 19, 11, 15, 18, 16, 18, 18, 19, 7, 4, 23, 23, 16, 17, 18, 18, 19, 24, 29, 30, 30, 22, 27, 21, 14, 15, 16, 20, 18, 23, 27, 18, 2, 10, 23, 22, 22, 17, 21]

	1.6 Generating battery schedule...
		[INFO] Case 1 exists — loaded from 'data/battery_demand/case1_real_only/battery_availability.npy' and 'data/battery_demand/case1_real_only/battery_details.npy' shape (168, 385, 36) and (4, 168, 385)
		[INFO] Case 2 exists — loaded from 'data/battery_demand/case2_nan_filled/battery_availability.npy' and 'data/battery_demand/case2_nan_filled/battery_details.npy' shape (1563, 385, 36) and (4, 1563, 385)
[ERROR] Could not load battery demand from 'data/battery_demand/case3_extended_generated/battery_demand.npy': [Errno 2] No such file or directory: 'data/battery_demand/case3_extended_generated/battery_demand.npy'


==================================================
PART 2: MILP Optimization...
==================================================

	2.1 Optimizing Case 1...
		[INFO] Loaded 168 samples from 'data/battery_demand/case1_real_only'
		[INFO] Results already exist at './data/optimization_results/case1_real_only/immediate_charging/V2B.npy'. Skipping immediate_charging run.
		[INFO] Found checkpoint: './data/optimization_results/case1_real_only/optimization_checkpoint.npz'
		[INFO] Resuming from iteration 50
		[INFO] Processing optimization series:   0%|                          | 0/118 [00:00<?, ?series/s]		[INFO] Processing optimization series:   1%|▏                 | 1/118 [00:00<01:14,  1.57series/s]		[INFO] Processing optimization series:   2%|▎                 | 2/118 [00:01<01:09,  1.68series/s]		[INFO] Processing optimization series:   3%|▍                 | 3/118 [00:01<01:07,  1.71series/s]		[INFO] Processing optimization series:   3%|▌                 | 4/118 [00:02<01:09,  1.65series/s]		[INFO] Processing optimization series:   4%|▊                 | 5/118 [00:02<01:07,  1.68series/s]		[INFO] Processing optimization series:   5%|▉                 | 6/118 [00:03<01:06,  1.69series/s]		[INFO] Processing optimization series:   6%|█                 | 7/118 [00:04<01:06,  1.66series/s]		[INFO] Processing optimization series:   7%|█▏                | 8/118 [00:04<01:05,  1.68series/s]		[INFO] Processing optimization series:   8%|█▎                | 9/118 [00:05<01:04,  1.68series/s]		[INFO] Processing optimization series:   8%|█▍               | 10/118 [00:06<01:11,  1.50series/s]		[INFO] Processing optimization series:   9%|█▌               | 11/118 [00:06<01:09,  1.53series/s]		[INFO] Processing optimization series:  10%|█▋               | 12/118 [00:07<01:07,  1.56series/s]		[INFO] Processing optimization series:  11%|█▊               | 13/118 [00:08<01:11,  1.46series/s]		[INFO] Processing optimization series:  12%|██               | 14/118 [00:08<01:10,  1.47series/s]		[INFO] Processing optimization series:  13%|██▏              | 15/118 [00:09<01:10,  1.47series/s]		[INFO] Processing optimization series:  14%|██▎              | 16/118 [00:10<01:11,  1.43series/s]		[INFO] Processing optimization series:  14%|██▍              | 17/118 [00:11<01:10,  1.43series/s]		[INFO] Processing optimization series:  15%|██▌              | 18/118 [00:11<01:10,  1.42series/s]		[INFO] Processing optimization series:  16%|██▋              | 19/118 [00:12<01:07,  1.46series/s]		[INFO] Processing optimization series:  17%|██▉              | 20/118 [00:13<01:08,  1.44series/s]		[INFO] Processing optimization series:  18%|███              | 21/118 [00:13<01:04,  1.51series/s]		[INFO] Processing optimization series:  19%|███▏             | 22/118 [00:14<01:04,  1.49series/s]		[INFO] Processing optimization series:  19%|███▎             | 23/118 [00:14<01:01,  1.55series/s]		[INFO] Processing optimization series:  20%|███▍             | 24/118 [00:15<00:59,  1.59series/s]		[INFO] Processing optimization series:  21%|███▌             | 25/118 [00:16<00:58,  1.58series/s]		[INFO] Processing optimization series:  22%|███▋             | 26/118 [00:16<00:56,  1.62series/s]		[INFO] Processing optimization series:  23%|███▉             | 27/118 [00:17<00:56,  1.60series/s]		[INFO] Processing optimization series:  24%|████             | 28/118 [00:17<00:54,  1.65series/s]		[INFO] Processing optimization series:  25%|████▏            | 29/118 [00:18<00:52,  1.69series/s]		[INFO] Processing optimization series:  25%|████▎            | 30/118 [00:19<00:56,  1.57series/s]		[INFO] Processing optimization series:  26%|████▍            | 31/118 [00:19<00:53,  1.63series/s]		[INFO] Processing optimization series:  27%|████▌            | 32/118 [00:20<00:51,  1.67series/s]		[INFO] Processing optimization series:  28%|████▊            | 33/118 [00:21<00:51,  1.65series/s]		[INFO] Processing optimization series:  29%|████▉            | 34/118 [00:21<00:49,  1.70series/s]		[INFO] Processing optimization series:  30%|█████            | 35/118 [00:22<00:48,  1.73series/s]		[INFO] Processing optimization series:  31%|█████▏           | 36/118 [00:22<00:48,  1.69series/s]		[INFO] Processing optimization series:  31%|█████▎           | 37/118 [00:23<00:47,  1.70series/s]		[INFO] Processing optimization series:  32%|█████▍           | 38/118 [00:23<00:46,  1.71series/s]		[INFO] Processing optimization series:  32%|█████▍           | 38/118 [00:24<00:51,  1.55series/s]
Traceback (most recent call last):
  File "/home/lisa4090/Documents/GitHub/V2B_Optimization_with_AI_on_BSS/main.py", line 65, in <module>
    main()
    ~~~~^^
  File "/home/lisa4090/Documents/GitHub/V2B_Optimization_with_AI_on_BSS/main.py", line 32, in main
    allocator.run_iterations(mode="optimization", rerun=False)
    ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lisa4090/Documents/GitHub/V2B_Optimization_with_AI_on_BSS/MILP/EnergyAllocator.py", line 151, in run_iterations
    result = optimizer.optimize(
        availability=availability_current,
    ...<6 lines>...
        pv=pv_current
    )
  File "/home/lisa4090/Documents/GitHub/V2B_Optimization_with_AI_on_BSS/MILP/GurobiOptimizer.py", line 181, in optimize
    SOC_val = np.array([[soc_t_v[t, v].x for v in range(n_veh)] for t in range(self.win_len)])
                         ~~~~~~~^^^^^^
KeyError: (16, <gurobi.Var SOC for vehicle[16,183] (value 0.24225406535947813)>)

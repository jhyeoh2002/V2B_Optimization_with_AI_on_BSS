Crash diagnostics ON


==================================================
PART 1: Data preprocess for 2023-01-01 00:00:00 to 2024-09-30 23:00:00...
==================================================

	1.1 Preprocessing radiation data...
		[INFO] Radiation data already exists at './data/timeseries/radiation_data.csv'

	1.2 Preprocessing temperature data...
		[INFO] Temperature data already exists at './data/timeseries/temperature_data.csv'

	1.3 Preprocessing building data...
		[INFO] Building data already exists at './data/timeseries/building_data.csv'

	1.4 Preprocessing electricity cost data...
		[INFO] Electricity cost data already exists at './data/timeseries/electricitycostG2B_data.csv' and './data/timeseries/electricitycostG2V_data.csv'

	1.5 Preprocessing battery demand series data...
		[INFO] Found existing battery data at './data/battery_demand/tol25/resample_full.csv' and './data/battery_demand/tol25/resample_train.csv'

		[INFO] Number of series for clean windows = (168, 37)
		[INFO] Number of eligible series for Case 2 = (1377, 37)
		[INFO] Number of seeds ready for Case 3  = (2000, 36)

		[INFO] Case 1 exists — loaded battery demand from './data/battery_demand/tol25/case1_real_only/battery_demand.npy' with shape (168, 37).
		[INFO] Case 2 exists — loaded battery demand from './data/battery_demand/tol25/case2_nan_filled/battery_demand.npy' with shape (1545, 37).
		[INFO] Case 3 exists — loaded battery demand from './data/battery_demand/tol25/case3_extended_generated/battery_demand.npy' with shape (3545, 37).
		[INFO] Case 0: Successfully added test pair 2024-03-15 & 2024-03-16
		Data: [10536, 28, 30, 35, 37, 37, 36, 33, 26, 10, 6, 10, 14, 19, 18, 15, 20, 26, 15, 9, 16, 21, 20, 8, 12, 15, 24, 31, 35, 32, 35, 34, 32, 31, 30, 22, 14, 18, 27, 18, 19, 19, 25, 25, 25, 26, 27, 17, 19]
		[INFO] Case 0: Successfully added test pair 2024-03-29 & 2024-03-30
		Data: [10872, 13, 26, 31, 33, 33, 33, 31, 15, 8, 19, 11, 15, 18, 16, 18, 18, 19, 7, 4, 23, 23, 16, 17, 18, 18, 19, 24, 29, 30, 30, 22, 27, 21, 14, 15, 16, 20, 18, 23, 27, 18, 2, 10, 23, 22, 22, 17, 21]

	1.6 Generating battery schedule...
		[INFO] Case 1 exists — loaded from './data/battery_demand/tol25/case1_real_only/battery_availability.npy' and './data/battery_demand/tol25/case1_real_only/battery_details.npy' shape (168, 263, 36) and (4, 168, 263)
		[INFO] Case 2 exists — loaded from './data/battery_demand/tol25/case2_nan_filled/battery_availability.npy' and './data/battery_demand/tol25/case2_nan_filled/battery_details.npy' shape (1545, 311, 36) and (4, 1545, 311)
		[INFO] Case 3 exists — loaded from './data/battery_demand/tol25/case3_extended_generated/battery_availability.npy' and './data/battery_demand/tol25/case3_extended_generated/battery_details.npy' shape (3545, 422, 36) and (4, 3545, 422)


==================================================
PART 2: MILP Optimization...
==================================================

	2.1 Optimizing Case 1...
		[INFO] Loaded 168 samples from './data/battery_demand/tol25/case1_real_only'
		[INFO] Results already exist at './data/optimization_results/tol25/case1_real_only/optimization/V2B.npy'. Skipping optimization run.
		[INFO] Results already exist at './data/optimization_results/tol25/case1_real_only/immediate_charging/V2B.npy'. Skipping immediate_charging run.
		[INFO] Case 1 completed.

	2.2 Optimizing Case 2...
		[INFO] Loaded 1545 samples from './data/battery_demand/tol25/case2_nan_filled'
		[INFO] Results already exist at './data/optimization_results/tol25/case2_nan_filled/optimization/V2B.npy'. Skipping optimization run.
		[INFO] Results already exist at './data/optimization_results/tol25/case2_nan_filled/immediate_charging/V2B.npy'. Skipping immediate_charging run.
		[INFO] Case 2 completed.

	2.3 Optimizing Case 3...
		[INFO] Loaded 3545 samples from './data/battery_demand/tol25/case3_extended_generated'
		[INFO] Results already exist at './data/optimization_results/tol25/case3_extended_generated/optimization/V2B.npy'. Skipping optimization run.
		[INFO] Results already exist at './data/optimization_results/tol25/case3_extended_generated/immediate_charging/V2B.npy'. Skipping immediate_charging run.
		[INFO] Case 3 completed.


==================================================
PART 3: Supervised Learning...
==================================================

	3.1 Training Case 1...
		=== Training Log Started: 2025-11-28 21:59:43.349066 ===
		Run Name: STAFV2_25_CASE1
		Device: cuda
		Epochs: 1000, Batch Size: 128, LR: 0.0005
		============================================================
		[INFO] Unique quantized indices: 6686
		[INFO] Suggested num_embeddings: 8023
		[INFO] Processed 168 valid samples.
		[INFO] Saved merged dataset: ./data/training_results/merged_windowed_dataset_STAFV2_25_CASE1.csv  (shape: (168, 429))
		[INFO] Saved feature metadata: ./data/training_results/feature_info_STAFV2_25_CASE1.json
		[INFO] Dataset split: 134 train, 34 val
		[INFO] Scalers fitted and saved.

		✅ Model initialized with 773476 params.
		============================================================
		--------------------------------------------------------------------------------------------
		  Epoch    |     LR     |  Train RMSE  |   Val RMSE   |  Train R²  |   Val R²   |  Patience 
		--------------------------------------------------------------------------------------------
		    1/1000 | 0.000500   |    9.50565   |    9.30703   |     -1.069 |     -1.050 |    0/150  
		    2/1000 | 0.000500   |    7.79199   |    9.19426   |     -0.979 |     -1.001 |    0/150  
		    3/1000 | 0.000500   |    8.93699   |    9.06152   |     -0.887 |     -0.944 |    0/150  
		    4/1000 | 0.000500   |    8.52904   |    8.95152   |     -0.810 |     -0.897 |    0/150  
		    5/1000 | 0.000500   |    7.69323   |    8.80647   |     -0.744 |     -0.836 |    0/150  
		    6/1000 | 0.000500   |    6.98257   |    8.61966   |     -0.667 |     -0.759 |    0/150  
		    7/1000 | 0.000500   |    8.32001   |    8.48365   |     -0.587 |     -0.704 |    0/150  
		    8/1000 | 0.000500   |    8.64982   |    8.32023   |     -0.526 |     -0.639 |    0/150  
		    9/1000 | 0.000500   |    9.85969   |    8.23729   |     -0.488 |     -0.606 |    0/150  
		   10/1000 | 0.000500   |    8.52468   |    8.11568   |     -0.415 |     -0.559 |    0/150  
		   11/1000 | 0.000500   |    6.06846   |    7.91453   |     -0.353 |     -0.483 |    0/150  
		   12/1000 | 0.000500   |    7.11973   |    7.71635   |     -0.279 |     -0.409 |    0/150  
		   13/1000 | 0.000500   |    5.43942   |    7.50761   |     -0.206 |     -0.334 |    0/150  
		   14/1000 | 0.000500   |    7.29308   |    7.34744   |     -0.171 |     -0.278 |    0/150  
		   15/1000 | 0.000500   |    7.98036   |    7.25991   |     -0.126 |     -0.248 |    0/150  
		   16/1000 | 0.000500   |    5.21179   |    6.94538   |     -0.087 |     -0.142 |    0/150  
		   17/1000 | 0.000500   |    6.56540   |    6.84756   |      0.036 |     -0.110 |    0/150  
		   18/1000 | 0.000500   |    6.42133   |    6.70418   |      0.065 |     -0.064 |    0/150  
		   19/1000 | 0.000500   |    6.12374   |    6.57011   |      0.104 |     -0.022 |    0/150  
		   20/1000 | 0.000500   |    5.80351   |    6.37347   |      0.155 |      0.039 |    0/150  
		   21/1000 | 0.000500   |    5.28882   |    6.13079   |      0.229 |      0.110 |    0/150  
		   22/1000 | 0.000500   |    5.82802   |    6.13072   |      0.265 |      0.110 |    0/150  
		   23/1000 | 0.000500   |    4.68742   |    5.83799   |      0.280 |      0.193 |    0/150  
		   24/1000 | 0.000500   |    5.45530   |    5.61207   |      0.344 |      0.255 |    0/150  
		   25/1000 | 0.000500   |    5.33837   |    5.49399   |      0.384 |      0.286 |    0/150  
		   26/1000 | 0.000500   |    4.98862   |    5.34474   |      0.417 |      0.324 |    0/150  
		   27/1000 | 0.000500   |    4.83564   |    5.28841   |      0.473 |      0.338 |    0/150  
		   28/1000 | 0.000500   |    4.43414   |    5.06227   |      0.476 |      0.393 |    0/150  
		   29/1000 | 0.000500   |    4.29220   |    5.08185   |      0.540 |      0.389 |    0/150  
		   30/1000 | 0.000500   |    3.97359   |    5.08816   |      0.563 |      0.387 |    1/150  
		   31/1000 | 0.000500   |    3.88529   |    4.96802   |      0.586 |      0.416 |    2/150  
		                                          ╚══> ✅ SAVED (RMSE: 4.9680)
		   32/1000 | 0.000500   |    4.73154   |    4.99043   |      0.589 |      0.411 |    0/150  
		   33/1000 | 0.000500   |    4.32348   |    4.93454   |      0.618 |      0.424 |    1/150  
		                                          ╚══> ✅ SAVED (RMSE: 4.9345)
		   34/1000 | 0.000500   |    3.77547   |    5.02570   |      0.651 |      0.402 |    0/150  
		   35/1000 | 0.000500   |    3.36325   |    5.04017   |      0.653 |      0.399 |    1/150  
		   36/1000 | 0.000500   |    3.36986   |    5.05938   |      0.659 |      0.394 |    2/150  
		   37/1000 | 0.000500   |    3.63787   |    5.13669   |      0.675 |      0.375 |    3/150  
		   38/1000 | 0.000500   |    3.60426   |    5.15776   |      0.683 |      0.370 |    4/150  
		   39/1000 | 0.000500   |    3.47171   |    5.22380   |      0.691 |      0.354 |    5/150  
		   40/1000 | 0.000500   |    3.27515   |    5.25326   |      0.698 |      0.347 |    6/150  
		   41/1000 | 0.000500   |    3.59052   |    5.25431   |      0.714 |      0.347 |    7/150  
		   42/1000 | 0.000500   |    3.72220   |    5.27874   |      0.711 |      0.340 |    8/150  
		   43/1000 | 0.000500   |    4.07138   |    5.27207   |      0.732 |      0.342 |    9/150  
		   44/1000 | 0.000500   |    3.38498   |    5.24439   |      0.749 |      0.349 |   10/150  
		   45/1000 | 0.000500   |    3.22653   |    5.21255   |      0.745 |      0.357 |   11/150  
		   46/1000 | 0.000500   |    3.52597   |    5.17451   |      0.763 |      0.366 |   12/150  
		   47/1000 | 0.000500   |    3.48523   |    5.09537   |      0.768 |      0.385 |   13/150  
		   48/1000 | 0.000500   |    2.85031   |    4.99384   |      0.788 |      0.410 |   14/150  
		   49/1000 | 0.000500   |    4.44341   |    4.87931   |      0.764 |      0.436 |   15/150  
		                                          ╚══> ✅ SAVED (RMSE: 4.8793)
		   50/1000 | 0.000500   |    3.09829   |    4.85075   |      0.797 |      0.443 |    0/150  
		                                          ╚══> ✅ SAVED (RMSE: 4.8508)
		   51/1000 | 0.000500   |    2.49505   |    4.77550   |      0.808 |      0.460 |    0/150  
		                                          ╚══> ✅ SAVED (RMSE: 4.7755)
		   52/1000 | 0.000500   |    3.24048   |    4.77030   |      0.810 |      0.461 |    0/150  
		                                          ╚══> ✅ SAVED (RMSE: 4.7703)
		   53/1000 | 0.000500   |    2.67187   |    4.74999   |      0.814 |      0.466 |    0/150  
		                                          ╚══> ✅ SAVED (RMSE: 4.7500)
		   54/1000 | 0.000500   |    2.48644   |    4.69187   |      0.822 |      0.479 |    0/150  
		                                          ╚══> ✅ SAVED (RMSE: 4.6919)
		   55/1000 | 0.000500   |    2.10411   |    4.67542   |      0.816 |      0.483 |    0/150  
		                                          ╚══> ✅ SAVED (RMSE: 4.6754)
		   56/1000 | 0.000500   |    3.19869   |    4.72429   |      0.828 |      0.472 |    0/150  
		   57/1000 | 0.000500   |    3.19167   |    4.67038   |      0.834 |      0.484 |    1/150  
		                                          ╚══> ✅ SAVED (RMSE: 4.6704)
		   58/1000 | 0.000500   |    2.68082   |    4.65451   |      0.837 |      0.487 |    0/150  
		                                          ╚══> ✅ SAVED (RMSE: 4.6545)
		   59/1000 | 0.000500   |    2.52938   |    4.64553   |      0.848 |      0.489 |    0/150  
		                                          ╚══> ✅ SAVED (RMSE: 4.6455)
		   60/1000 | 0.000500   |    3.05522   |    4.64627   |      0.846 |      0.489 |    0/150  
		   61/1000 | 0.000500   |    2.38303   |    4.68065   |      0.871 |      0.481 |    1/150  
		   62/1000 | 0.000500   |    1.64284   |    4.71243   |      0.881 |      0.474 |    2/150  
		   63/1000 | 0.000500   |    2.19407   |    4.77525   |      0.872 |      0.460 |    3/150  
		   64/1000 | 0.000500   |    1.97868   |    4.82540   |      0.877 |      0.449 |    4/150  
		   65/1000 | 0.000500   |    2.32682   |    4.86243   |      0.891 |      0.440 |    5/150  
		   66/1000 | 0.000500   |    1.99895   |    4.82739   |      0.886 |      0.448 |    6/150  
		   67/1000 | 0.000500   |    3.16906   |    4.82797   |      0.897 |      0.448 |    7/150  
		   68/1000 | 0.000500   |    2.43781   |    4.81137   |      0.912 |      0.452 |    8/150  
		   69/1000 | 0.000500   |    4.06198   |    4.84777   |      0.879 |      0.444 |    9/150  
		   70/1000 | 0.000500   |    1.77660   |    4.87352   |      0.914 |      0.438 |   10/150  
		   71/1000 | 0.000500   |    2.54649   |    4.89540   |      0.903 |      0.433 |   11/150  
		   72/1000 | 0.000500   |    2.21471   |    4.94254   |      0.900 |      0.422 |   12/150  
		   73/1000 | 0.000500   |    1.81469   |    4.96422   |      0.921 |      0.417 |   13/150  
		   74/1000 | 0.000500   |    1.71985   |    4.99331   |      0.917 |      0.410 |   14/150  
		   75/1000 | 0.000450   |    3.38123   |    5.06642   |      0.893 |      0.392 |   15/150  
		   76/1000 | 0.000450   |    1.66362   |    5.12808   |      0.939 |      0.378 |   16/150  
		   77/1000 | 0.000450   |    2.09369   |    5.19378   |      0.925 |      0.362 |   17/150  
		   78/1000 | 0.000450   |    2.31374   |    5.20424   |      0.931 |      0.359 |   18/150  
		   79/1000 | 0.000450   |    1.68050   |    5.23158   |      0.919 |      0.352 |   19/150  
		   80/1000 | 0.000450   |    2.46664   |    5.28350   |      0.916 |      0.339 |   20/150  
		   81/1000 | 0.000450   |    1.74028   |    5.30385   |      0.931 |      0.334 |   21/150  
		   82/1000 | 0.000450   |    2.50037   |    5.32157   |      0.916 |      0.330 |   22/150  
		   83/1000 | 0.000450   |    2.31776   |    5.32094   |      0.928 |      0.330 |   23/150  
		   84/1000 | 0.000450   |    2.91355   |    5.27837   |      0.921 |      0.341 |   24/150  
		   85/1000 | 0.000450   |    1.93746   |    5.26965   |      0.931 |      0.343 |   25/150  
		   86/1000 | 0.000450   |    1.25365   |    5.24778   |      0.940 |      0.348 |   26/150  
		   87/1000 | 0.000450   |    2.12541   |    5.23150   |      0.923 |      0.352 |   27/150  
		   88/1000 | 0.000450   |    1.79646   |    5.22671   |      0.936 |      0.353 |   28/150  
		   89/1000 | 0.000450   |    1.96297   |    5.21955   |      0.950 |      0.355 |   29/150  
		   90/1000 | 0.000450   |    1.80439   |    5.24434   |      0.934 |      0.349 |   30/150  
		   91/1000 | 0.000405   |    1.33160   |    5.26423   |      0.950 |      0.344 |   31/150  
		   92/1000 | 0.000405   |    2.07760   |    5.30155   |      0.935 |      0.335 |   32/150  
		   93/1000 | 0.000405   |    2.13572   |    5.27395   |      0.949 |      0.342 |   33/150  
		   94/1000 | 0.000405   |    2.03701   |    5.29043   |      0.941 |      0.338 |   34/150  
		   95/1000 | 0.000405   |    2.51060   |    5.29117   |      0.942 |      0.337 |   35/150  
		   96/1000 | 0.000405   |    2.29848   |    5.28952   |      0.951 |      0.338 |   36/150  
		   97/1000 | 0.000405   |    2.25365   |    5.30925   |      0.947 |      0.333 |   37/150  
		   98/1000 | 0.000405   |    1.34407   |    5.29137   |      0.954 |      0.337 |   38/150  
		   99/1000 | 0.000405   |    1.46424   |    5.28483   |      0.956 |      0.339 |   39/150  
		  100/1000 | 0.000405   |    1.55148   |    5.26891   |      0.957 |      0.343 |   40/150  
		  101/1000 | 0.000405   |    1.14596   |    5.28640   |      0.954 |      0.339 |   41/150  
		  102/1000 | 0.000405   |    1.79056   |    5.26187   |      0.957 |      0.345 |   42/150  
		  103/1000 | 0.000405   |    2.07169   |    5.24269   |      0.950 |      0.349 |   43/150  
		  104/1000 | 0.000405   |    2.22955   |    5.23930   |      0.945 |      0.350 |   44/150  
		  105/1000 | 0.000405   |    1.26048   |    5.21354   |      0.955 |      0.357 |   45/150  
		  106/1000 | 0.000405   |    3.56600   |    5.17223   |      0.940 |      0.367 |   46/150  
		  107/1000 | 0.000365   |    2.70143   |    5.16296   |      0.934 |      0.369 |   47/150  
		  108/1000 | 0.000365   |    3.09971   |    5.18622   |      0.945 |      0.363 |   48/150  
		  109/1000 | 0.000365   |    3.82557   |    5.25373   |      0.925 |      0.347 |   49/150  
		  110/1000 | 0.000365   |    1.49162   |    5.23327   |      0.956 |      0.352 |   50/150  
		  111/1000 | 0.000365   |    1.73650   |    5.21983   |      0.957 |      0.355 |   51/150  
		  112/1000 | 0.000365   |    2.05328   |    5.24506   |      0.947 |      0.349 |   52/150  
		  113/1000 | 0.000365   |    1.31619   |    5.25214   |      0.962 |      0.347 |   53/150  
		  114/1000 | 0.000365   |    3.09129   |    5.24994   |      0.935 |      0.348 |   54/150  
		  115/1000 | 0.000365   |    1.56701   |    5.18151   |      0.958 |      0.365 |   55/150  
		  116/1000 | 0.000365   |    1.69525   |    5.17881   |      0.952 |      0.365 |   56/150  
		  117/1000 | 0.000365   |    3.09406   |    5.17162   |      0.941 |      0.367 |   57/150  
		  118/1000 | 0.000365   |    1.55680   |    5.15421   |      0.950 |      0.371 |   58/150  
		  119/1000 | 0.000365   |    1.49190   |    5.15532   |      0.944 |      0.371 |   59/150  
		  120/1000 | 0.000365   |    2.19538   |    5.11444   |      0.932 |      0.381 |   60/150  
		  121/1000 | 0.000365   |    2.09465   |    5.11591   |      0.949 |      0.381 |   61/150  
		  122/1000 | 0.000365   |    1.50971   |    5.13813   |      0.949 |      0.375 |   62/150  
		  123/1000 | 0.000328   |    1.41559   |    5.14551   |      0.950 |      0.373 |   63/150  
		  124/1000 | 0.000328   |    1.91638   |    5.16067   |      0.951 |      0.370 |   64/150  
		  125/1000 | 0.000328   |    1.93995   |    5.17283   |      0.942 |      0.367 |   65/150  
		  126/1000 | 0.000328   |    1.59914   |    5.18367   |      0.946 |      0.364 |   66/150  
		  127/1000 | 0.000328   |    1.25943   |    5.20513   |      0.953 |      0.359 |   67/150  
		  128/1000 | 0.000328   |    1.98678   |    5.22053   |      0.940 |      0.355 |   68/150  
		  129/1000 | 0.000328   |    2.95830   |    5.24121   |      0.947 |      0.350 |   69/150  

nohup: ignoring input
Crash diagnostics ON


==================================================
PART 1: Data preprocess for 2023-01-01 00:00:00 to 2024-09-30 23:00:00...
==================================================

	1.1 Preprocessing radiation data...
		[INFO] Radiation data already exists at './data/timeseries/radiation_data.csv'

	1.2 Preprocessing temperature data...
		[INFO] Temperature data already exists at './data/timeseries/temperature_data.csv'

	1.3 Preprocessing building data...
		[INFO] Building data already exists at './data/timeseries/building_data.csv'

	1.4 Preprocessing electricity cost data...
		[INFO] Electricity cost data already exists at './data/timeseries/electricitycostG2B_data.csv' and './data/timeseries/electricitycostG2V_data.csv'

	1.5 Preprocessing battery demand series data...
		[INFO] Found existing battery data at 'data/battery_demandV2/resample_full.csv' and 'data/battery_demandV2/resample_train.csv'

		[INFO] Number of series for clean windows = (168, 37)
		[INFO] Number of eligible series for Case 2 = (1395, 37)
		[INFO] Case 1 exists â€” loaded battery demand from 'data/battery_demandV2/case1_real_only/battery_demand.npy' with shape (168, 37).
		[INFO] Case 2 exists â€” loaded battery demand from 'data/battery_demandV2/case2_nan_filled/battery_demand.npy' with shape (1563, 37).
		[INFO] Case 0 exists â€” loaded battery demand from 'data/battery_demandV2/case0_test/battery_demand.npy' with shape (2, 49).

	1.6 Generating battery schedule...
		[INFO] Case 0 exists â€” loaded from 'data/battery_demandV2/case0_test/battery_availability.npy' and 'data/battery_demandV2/case0_test/battery_details.npy' shape (2, 272, 48) and (4, 2, 272)
		[INFO] Case 1 exists â€” loaded from 'data/battery_demandV2/case1_real_only/battery_availability.npy' and 'data/battery_demandV2/case1_real_only/battery_details.npy' shape (168, 237, 36) and (4, 168, 237)
		[INFO] Case 2 exists â€” loaded from 'data/battery_demandV2/case2_nan_filled/battery_availability.npy' and 'data/battery_demandV2/case2_nan_filled/battery_details.npy' shape (1563, 237, 36) and (4, 1563, 237)
		[ERROR] Could not load battery demand from 'data/battery_demandV2/case3_extended_generated/battery_demand.npy': [Errno 2] No such file or directory: 'data/battery_demandV2/case3_extended_generated/battery_demand.npy'


==================================================
PART 2: MILP Optimization...
==================================================

	2.0 Optimizing Case 0...
		[INFO] Loaded 2 samples from 'data/battery_demandV2/case0_test'
		[INFO] Results already exist at 'data/optimization_resultsV2/case0_test/immediate_charging/V2B.npy'. Skipping immediate_charging run.
		[INFO] Results already exist at 'data/optimization_resultsV2/case0_test/optimization/V2B.npy'. Skipping optimization run.
		[INFO] Case 0 completed.

	2.1 Optimizing Case 1...
		[INFO] Loaded 168 samples from 'data/battery_demandV2/case1_real_only'
		[INFO] Results already exist at 'data/optimization_resultsV2/case1_real_only/immediate_charging/V2B.npy'. Skipping immediate_charging run.
		[INFO] Results already exist at 'data/optimization_resultsV2/case1_real_only/optimization/V2B.npy'. Skipping optimization run.
		[INFO] Case 1 completed.

	2.2 Optimizing Case 2...
		[INFO] Loaded 1563 samples from 'data/battery_demandV2/case2_nan_filled'
		[INFO] Results already exist at 'data/optimization_resultsV2/case2_nan_filled/immediate_charging/V2B.npy'. Skipping immediate_charging run.
		[INFO] Results already exist at 'data/optimization_resultsV2/case2_nan_filled/optimization/V2B.npy'. Skipping optimization run.
		[INFO] Case 2 completed.


==================================================
PART 3: Supervised Learning...
==================================================

	3.2 Training Case 2...

=== Starting Training Run: STAFV5_CASE2 ===
Device: cuda
		[INFO] Starting Preprocessing for Case 2...
		[INFO] Unique quantized indices: 28274
		[INFO] Suggested num_embeddings: 33928
		[INFO] Generating sliding windows...
		[INFO] Saved dataset: ./data/training_results/STAFV5_CASE2/merged_dataset_STAFV5_CASE2.csv (Shape: (18756, 225))
		[INFO] Saved metadata: ./data/training_results/STAFV5_CASE2/feature_info_STAFV5_CASE2.json
	[Model Config] Detected Dims: {'static': 4, 'series_count': 6, 'seq_len': 24, 'vehicle': 76, 'emb_vocab': 10000}
		[INFO] Data loaded. Train: 13129, Val: 5627
		[INFO] Fitting new scalers on training data...
		[INFO] Calculating weights for imbalanced regression...
		[INFO] 
==================================================
		[INFO] ðŸš€ TRAINING SESSION: STAFV5_CASE2
		[INFO] ==================================================
		[INFO] Device:             cuda
		[INFO] Model Parameters:   114,058
		[INFO] --------------------------------------------------
		[INFO] Epochs:             5000
		[INFO] Batch Size:         64
		[INFO] Learning Rate:      0.001
		[INFO] Weight Decay:       0.001
		[INFO] Dropout:            0.5
		[INFO] --------------------------------------------------
		[INFO] Hidden Layers:      [128, 32]
		[INFO] Embedding Dim:      8
		[INFO] Attention Heads:    4
		[INFO]==================================================


		[INFO]Epoch |    LR    | Trn RMSE | Val RMSE | Trn R2 | Val R2 | Stop
-----------------------------------------------------------------
		[INFO]    1 | 0.001000 |   6.5470 |   7.3451 |  0.342 | -0.030 | 0/150
		[INFO]    2 | 0.001000 |   4.9835 |   5.8463 |  0.623 |  0.347 | 0/150
		[INFO]    3 | 0.001000 |   4.6224 |   6.2515 |  0.674 |  0.254 | 0/150
		[INFO]    4 | 0.001000 |   4.4857 |   5.7385 |  0.698 |  0.371 | 1/150
		[INFO]    5 | 0.001000 |   4.4070 |   5.8503 |  0.706 |  0.346 | 0/150
		[INFO]    6 | 0.001000 |   4.3218 |   5.6214 |  0.718 |  0.396 | 1/150
		[INFO]    7 | 0.001000 |   4.2827 |   5.7010 |  0.722 |  0.379 | 0/150
		[INFO]    8 | 0.001000 |   4.1818 |   5.8050 |  0.733 |  0.356 | 1/150
		[INFO]    9 | 0.001000 |   4.0833 |   5.6972 |  0.747 |  0.380 | 2/150
		[INFO]   10 | 0.001000 |   4.1065 |   5.7367 |  0.745 |  0.371 | 3/150
		[INFO]   11 | 0.001000 |   4.0913 |   5.4383 |  0.749 |  0.435 | 4/150
		[INFO]   12 | 0.001000 |   4.0269 |   5.4499 |  0.753 |  0.433 | 0/150
		[INFO]   13 | 0.001000 |   3.9147 |   5.4299 |  0.767 |  0.437 | 1/150
		[INFO]   14 | 0.001000 |   3.9553 |   5.6850 |  0.764 |  0.383 | 0/150
		[INFO]   15 | 0.001000 |   3.8476 |   5.7061 |  0.775 |  0.378 | 1/150
		[INFO]   16 | 0.001000 |   3.9206 |   5.5586 |  0.769 |  0.410 | 2/150
		[INFO]   17 | 0.001000 |   3.8858 |   5.3616 |  0.769 |  0.451 | 3/150
		[INFO]   18 | 0.001000 |   3.8874 |   5.1422 |  0.773 |  0.495 | 0/150
		[INFO]   19 | 0.001000 |   3.8483 |   5.2530 |  0.775 |  0.473 | 0/150
		[INFO]   20 | 0.001000 |   3.7814 |   5.1199 |  0.784 |  0.499 | 1/150
		[INFO]   21 | 0.001000 |   3.7904 |   5.3416 |  0.780 |  0.455 | 0/150
		[INFO]   22 | 0.001000 |   3.7712 |   5.4095 |  0.788 |  0.441 | 1/150
		[INFO]   23 | 0.001000 |   3.7304 |   5.2634 |  0.789 |  0.471 | 2/150
		[INFO]   24 | 0.001000 |   3.7642 |   5.5193 |  0.786 |  0.418 | 3/150
		[INFO]   25 | 0.001000 |   3.7755 |   5.8404 |  0.786 |  0.348 | 4/150
		[INFO]   26 | 0.001000 |   3.6700 |   5.3602 |  0.795 |  0.451 | 5/150
		[INFO]   27 | 0.001000 |   3.6513 |   5.4022 |  0.796 |  0.443 | 6/150
		[INFO]   28 | 0.001000 |   3.6509 |   5.1206 |  0.798 |  0.499 | 7/150
		[INFO]   29 | 0.001000 |   3.7033 |   5.7008 |  0.790 |  0.379 | 8/150
		[INFO]   30 | 0.001000 |   3.6736 |   5.1787 |  0.795 |  0.488 | 9/150
		[INFO]   31 | 0.001000 |   3.6671 |   5.2231 |  0.795 |  0.479 | 10/150
		[INFO]   32 | 0.001000 |   3.6453 |   5.2221 |  0.798 |  0.479 | 11/150
		[INFO]   33 | 0.001000 |   3.6605 |   5.1679 |  0.800 |  0.490 | 12/150
		[INFO]   34 | 0.001000 |   3.6247 |   5.1523 |  0.800 |  0.493 | 13/150
		[INFO]   35 | 0.001000 |   3.6244 |   5.2521 |  0.802 |  0.473 | 14/150
		[INFO]   36 | 0.001000 |   3.6390 |   5.3179 |  0.800 |  0.460 | 15/150
		[INFO]   37 | 0.001000 |   3.6406 |   5.3579 |  0.800 |  0.452 | 16/150
		[INFO]   38 | 0.001000 |   3.5973 |   5.4954 |  0.802 |  0.423 | 17/150
		[INFO]   39 | 0.001000 |   3.6050 |   4.9731 |  0.803 |  0.528 | 18/150
		[INFO]   40 | 0.001000 |   3.5730 |   5.4770 |  0.807 |  0.427 | 0/150
		[INFO]   41 | 0.001000 |   3.6078 |   5.1184 |  0.803 |  0.500 | 1/150
		[INFO]   42 | 0.001000 |   3.6125 |   5.1384 |  0.804 |  0.496 | 2/150
		[INFO]   43 | 0.001000 |   3.5309 |   5.3097 |  0.811 |  0.461 | 3/150
		[INFO]   44 | 0.001000 |   3.5202 |   5.0653 |  0.812 |  0.510 | 4/150
		[INFO]   45 | 0.001000 |   3.6037 |   5.4160 |  0.805 |  0.440 | 5/150
		[INFO]   46 | 0.001000 |   3.5612 |   5.2750 |  0.807 |  0.468 | 6/150
		[INFO]   47 | 0.001000 |   3.5623 |   5.0908 |  0.807 |  0.505 | 7/150
		[INFO]   48 | 0.001000 |   3.5230 |   5.1500 |  0.814 |  0.493 | 8/150
		[INFO]   49 | 0.001000 |   3.5700 |   5.0524 |  0.809 |  0.512 | 9/150
		[INFO]   50 | 0.001000 |   3.5206 |   5.0632 |  0.810 |  0.510 | 10/150
		[INFO]   51 | 0.001000 |   3.4878 |   5.4511 |  0.815 |  0.432 | 11/150
		[INFO]   52 | 0.001000 |   3.5604 |   5.2623 |  0.810 |  0.471 | 12/150
		[INFO]   53 | 0.001000 |   3.5930 |   5.5546 |  0.814 |  0.411 | 13/150
		[INFO]   54 | 0.001000 |   3.5071 |   5.2391 |  0.811 |  0.476 | 14/150
		[INFO]   55 | 0.001000 |   3.5129 |   5.3137 |  0.815 |  0.461 | 15/150
		[INFO]   56 | 0.001000 |   3.5445 |   5.1273 |  0.811 |  0.498 | 16/150
		[INFO]   57 | 0.001000 |   3.4752 |   5.1869 |  0.816 |  0.486 | 17/150
		[INFO]   58 | 0.001000 |   3.4981 |   5.2067 |  0.817 |  0.482 | 18/150
		[INFO]   59 | 0.001000 |   3.5133 |   5.0836 |  0.812 |  0.506 | 19/150
		[INFO]   60 | 0.001000 |   3.5061 |   5.1119 |  0.814 |  0.501 | 20/150
		[INFO]   61 | 0.000750 |   3.4679 |   4.9810 |  0.818 |  0.526 | 21/150
		[INFO]   62 | 0.000750 |   3.4403 |   4.7576 |  0.821 |  0.568 | 22/150
		[INFO]   63 | 0.000750 |   3.4152 |   5.3176 |  0.822 |  0.460 | 0/150
		[INFO]   64 | 0.000750 |   3.4347 |   5.3685 |  0.817 |  0.449 | 1/150
		[INFO]   65 | 0.000750 |   3.4360 |   4.9819 |  0.819 |  0.526 | 2/150
		[INFO]   66 | 0.000750 |   3.4222 |   4.9587 |  0.823 |  0.530 | 3/150
		[INFO]   67 | 0.000750 |   3.3872 |   5.3508 |  0.827 |  0.453 | 4/150
		[INFO]   68 | 0.000750 |   3.4153 |   4.8713 |  0.824 |  0.547 | 5/150
Traceback (most recent call last):
  File "/home/lisa4090/anaconda3/envs/AIonBSS/lib/python3.13/multiprocessing/resource_sharer.py", line 138, in _serve
    with self._listener.accept() as conn:
         ~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/lisa4090/anaconda3/envs/AIonBSS/lib/python3.13/multiprocessing/connection.py", line 482, in accept
    deliver_challenge(c, self._authkey)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/lisa4090/anaconda3/envs/AIonBSS/lib/python3.13/multiprocessing/connection.py", line 939, in deliver_challenge
    response = connection.recv_bytes(256)        # reject large message
  File "/home/lisa4090/anaconda3/envs/AIonBSS/lib/python3.13/multiprocessing/connection.py", line 216, in recv_bytes
    buf = self._recv_bytes(maxlength)
  File "/home/lisa4090/anaconda3/envs/AIonBSS/lib/python3.13/multiprocessing/connection.py", line 430, in _recv_bytes
    buf = self._recv(4)
  File "/home/lisa4090/anaconda3/envs/AIonBSS/lib/python3.13/multiprocessing/connection.py", line 395, in _recv
    chunk = read(handle, remaining)
ConnectionResetError: [Errno 104] Connection reset by peer

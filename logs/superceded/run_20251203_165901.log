nohup: ignoring input
Crash diagnostics ON


==================================================
PART 1: Data preprocess for 2023-01-01 00:00:00 to 2024-09-30 23:00:00...
==================================================

	1.1 Preprocessing radiation data...
		[INFO] Radiation data already exists at './data/timeseries/radiation_data.csv'

	1.2 Preprocessing temperature data...
		[INFO] Temperature data already exists at './data/timeseries/temperature_data.csv'

	1.3 Preprocessing building data...
		[INFO] Building data already exists at './data/timeseries/building_data.csv'

	1.4 Preprocessing electricity cost data...
		[INFO] Electricity cost data already exists at './data/timeseries/electricitycostG2B_data.csv' and './data/timeseries/electricitycostG2V_data.csv'

	1.5 Preprocessing battery demand series data...
		[INFO] Found existing battery data at 'data/battery_demand/resample_full.csv' and 'data/battery_demand/resample_train.csv'

		[INFO] Number of series for clean windows = (168, 37)
		[INFO] Number of eligible series for Case 2 = (1395, 37)
		[INFO] Case 1 exists — loaded battery demand from 'data/battery_demand/case1_real_only/battery_demand.npy' with shape (168, 37).
		[INFO] Case 2 exists — loaded battery demand from 'data/battery_demand/case2_nan_filled/battery_demand.npy' with shape (1563, 37).
		[INFO] Case 0: Successfully added test pair 2024-03-15 & 2024-03-16
		Data: [10536, 28, 30, 35, 37, 37, 36, 33, 26, 10, 6, 10, 14, 19, 18, 15, 20, 26, 15, 9, 16, 21, 20, 8, 12, 15, 24, 31, 35, 32, 35, 34, 32, 31, 30, 22, 14, 18, 27, 18, 19, 19, 25, 25, 25, 26, 27, 17, 19]
		[INFO] Case 0: Successfully added test pair 2024-03-29 & 2024-03-30
		Data: [10872, 13, 26, 31, 33, 33, 33, 31, 15, 8, 19, 11, 15, 18, 16, 18, 18, 19, 7, 4, 23, 23, 16, 17, 18, 18, 19, 24, 29, 30, 30, 22, 27, 21, 14, 15, 16, 20, 18, 23, 27, 18, 2, 10, 23, 22, 22, 17, 21]

	1.6 Generating battery schedule...
		[INFO] Case 1 exists — loaded from 'data/battery_demand/case1_real_only/battery_availability.npy' and 'data/battery_demand/case1_real_only/battery_details.npy' shape (168, 385, 36) and (4, 168, 385)
		[INFO] Case 2 exists — loaded from 'data/battery_demand/case2_nan_filled/battery_availability.npy' and 'data/battery_demand/case2_nan_filled/battery_details.npy' shape (1563, 385, 36) and (4, 1563, 385)
[ERROR] Could not load battery demand from 'data/battery_demand/case3_extended_generated/battery_demand.npy': [Errno 2] No such file or directory: 'data/battery_demand/case3_extended_generated/battery_demand.npy'


==================================================
PART 2: MILP Optimization...
==================================================

	2.1 Optimizing Case 1...
		[INFO] Loaded 168 samples from 'data/battery_demand/case1_real_only'
		[INFO] Results already exist at './data/optimization_results/case1_real_only/immediate_charging/V2B.npy'. Skipping immediate_charging run.
		[INFO] Results already exist at './data/optimization_results/case1_real_only/optimization/V2B.npy'. Skipping optimization run.
		[INFO] Case 1 completed.

	2.2 Optimizing Case 2...
		[INFO] Loaded 1563 samples from 'data/battery_demand/case2_nan_filled'
		[INFO] Results already exist at './data/optimization_results/case2_nan_filled/immediate_charging/V2B.npy'. Skipping immediate_charging run.
		[INFO] Results already exist at './data/optimization_results/case2_nan_filled/optimization/V2B.npy'. Skipping optimization run.
		[INFO] Case 2 completed.


==================================================
PART 3: Supervised Learning...
==================================================

	3.1 Training Case 1...
		=== Training Log Started: 2025-12-03 16:59:02.850835 ===
		Run Name: STAFV2_33_CASE1
		Device: cuda
		Epochs: 1000, Batch Size: 4, LR: 0.05
		============================================================
		[INFO] Unique quantized indices: 6686
		[INFO] Suggested num_embeddings: 8023
		[INFO] Processed 168 valid samples.
		[INFO] Saved merged dataset: ./data/training_results/merged_windowed_dataset_STAFV2_33_CASE1.csv  (shape: (168, 201))
		[INFO] Saved feature metadata: ./data/training_results/feature_info_STAFV2_33_CASE1.json
		[INFO] Dataset split: 134 train, 34 val
Traceback (most recent call last):
  File "/home/lisa4090/Documents/GitHub/V2B_Optimization_with_AI_on_BSS/main.py", line 65, in <module>
    main()
    ~~~~^^
  File "/home/lisa4090/Documents/GitHub/V2B_Optimization_with_AI_on_BSS/main.py", line 42, in main
    train(case_id=case_num, tolerance=target_tolerance)
    ~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lisa4090/Documents/GitHub/V2B_Optimization_with_AI_on_BSS/supervised_learning/training.py", line 148, in train
    train_loader, val_loader = get_loaders_from_files(
                               ~~~~~~~~~~~~~~~~~~~~~~^
        merged_csv_path=DATA_CSV,
        ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
        num_workers=2,
        ^^^^^^^^^^^^^^
    )
    ^
  File "/home/lisa4090/Documents/GitHub/V2B_Optimization_with_AI_on_BSS/supervised_learning/dataloader/loader.py", line 118, in get_loaders_from_files
    static_scaler, series_scaler, battery_scaler = fit_and_transform_scalers(
                                                   ~~~~~~~~~~~~~~~~~~~~~~~~~^
        train_df, static_cols, series_cols_list, battery_cols_list, save_dir=scaler_dir
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/lisa4090/Documents/GitHub/V2B_Optimization_with_AI_on_BSS/supervised_learning/dataloader/loader.py", line 76, in fit_and_transform_scalers
    battery_scaler = StandardScaler().fit(train_df[battery_cols].to_numpy())
                                          ~~~~~~~~^^^^^^^^^^^^^^
  File "/home/lisa4090/anaconda3/envs/AIonBSS/lib/python3.13/site-packages/pandas/core/frame.py", line 4108, in __getitem__
    indexer = self.columns._get_indexer_strict(key, "columns")[1]
              ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^
  File "/home/lisa4090/anaconda3/envs/AIonBSS/lib/python3.13/site-packages/pandas/core/indexes/base.py", line 6200, in _get_indexer_strict
    self._raise_if_missing(keyarr, indexer, axis_name)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lisa4090/anaconda3/envs/AIonBSS/lib/python3.13/site-packages/pandas/core/indexes/base.py", line 6252, in _raise_if_missing
    raise KeyError(f"{not_found} not in index")
KeyError: "['SOC_current_V1', 'SOC_current_V2', 'SOC_current_V3', 'SOC_current_V4', 'SOC_current_V5', 'SOC_current_V6', 'SOC_current_V7', 'SOC_current_V8', 'SOC_current_V9', 'SOC_current_V10', 'SOC_current_V11', 'SOC_current_V12', 'SOC_current_V13', 'SOC_current_V14', 'SOC_current_V15', 'SOC_current_V16', 'SOC_current_V17', 'SOC_current_V18', 'SOC_current_V19', 'SOC_current_V20', 'SOC_current_V21', 'SOC_current_V22', 'SOC_current_V23', 'SOC_current_V24', 'SOC_current_V25', 'SOC_current_V26', 'SOC_current_V27', 'SOC_current_V28', 'SOC_current_V29', 'SOC_current_V30', 'SOC_current_V31', 'SOC_current_V32', 'SOC_current_V33', 'SOC_current_V34', 'SOC_current_V35', 'SOC_current_V36', 'SOC_current_V37', 'SOC_current_V38', 'SOC_current_V39', 'SOC_current_V40', 'SOC_current_V41', 'SOC_current_V42', 'SOC_current_V43', 'SOC_current_V44', 'SOC_current_V45', 'SOC_current_V46', 'SOC_current_V47', 'SOC_current_V48', 'SOC_current_V49', 'SOC_current_V50', 'SOC_current_V51', 'SOC_current_V52', 'SOC_current_V53', 'SOC_current_V54', 'SOC_current_V55', 'SOC_current_V56', 'SOC_current_V57', 'SOC_current_V58', 'SOC_current_V59', 'SOC_current_V60', 'SOC_current_V61', 'SOC_current_V62', 'SOC_current_V63', 'SOC_current_V64', 'SOC_current_V65', 'SOC_current_V66', 'SOC_current_V67', 'SOC_current_V68', 'SOC_current_V69', 'SOC_current_V70', 'SOC_current_V71', 'SOC_current_V72', 'SOC_current_V73', 'SOC_current_V74', 'SOC_current_V75', 'SOC_current_V76', 'departure_soc_V1', 'departure_soc_V2', 'departure_soc_V3', 'departure_soc_V4', 'departure_soc_V5', 'departure_soc_V6', 'departure_soc_V7', 'departure_soc_V8', 'departure_soc_V9', 'departure_soc_V10', 'departure_soc_V11', 'departure_soc_V12', 'departure_soc_V13', 'departure_soc_V14', 'departure_soc_V15', 'departure_soc_V16', 'departure_soc_V17', 'departure_soc_V18', 'departure_soc_V19', 'departure_soc_V20', 'departure_soc_V21', 'departure_soc_V22', 'departure_soc_V23', 'departure_soc_V24', 'departure_soc_V25', 'departure_soc_V26', 'departure_soc_V27', 'departure_soc_V28', 'departure_soc_V29', 'departure_soc_V30', 'departure_soc_V31', 'departure_soc_V32', 'departure_soc_V33', 'departure_soc_V34', 'departure_soc_V35', 'departure_soc_V36', 'departure_soc_V37', 'departure_soc_V38', 'departure_soc_V39', 'departure_soc_V40', 'departure_soc_V41', 'departure_soc_V42', 'departure_soc_V43', 'departure_soc_V44', 'departure_soc_V45', 'departure_soc_V46', 'departure_soc_V47', 'departure_soc_V48', 'departure_soc_V49', 'departure_soc_V50', 'departure_soc_V51', 'departure_soc_V52', 'departure_soc_V53', 'departure_soc_V54', 'departure_soc_V55', 'departure_soc_V56', 'departure_soc_V57', 'departure_soc_V58', 'departure_soc_V59', 'departure_soc_V60', 'departure_soc_V61', 'departure_soc_V62', 'departure_soc_V63', 'departure_soc_V64', 'departure_soc_V65', 'departure_soc_V66', 'departure_soc_V67', 'departure_soc_V68', 'departure_soc_V69', 'departure_soc_V70', 'departure_soc_V71', 'departure_soc_V72', 'departure_soc_V73', 'departure_soc_V74', 'departure_soc_V75', 'departure_soc_V76', 'departure_time_V1', 'departure_time_V2', 'departure_time_V3', 'departure_time_V4', 'departure_time_V5', 'departure_time_V6', 'departure_time_V7', 'departure_time_V8', 'departure_time_V9', 'departure_time_V10', 'departure_time_V11', 'departure_time_V12', 'departure_time_V13', 'departure_time_V14', 'departure_time_V15', 'departure_time_V16', 'departure_time_V17', 'departure_time_V18', 'departure_time_V19', 'departure_time_V20', 'departure_time_V21', 'departure_time_V22', 'departure_time_V23', 'departure_time_V24', 'departure_time_V25', 'departure_time_V26', 'departure_time_V27', 'departure_time_V28', 'departure_time_V29', 'departure_time_V30', 'departure_time_V31', 'departure_time_V32', 'departure_time_V33', 'departure_time_V34', 'departure_time_V35', 'departure_time_V36', 'departure_time_V37', 'departure_time_V38', 'departure_time_V39', 'departure_time_V40', 'departure_time_V41', 'departure_time_V42', 'departure_time_V43', 'departure_time_V44', 'departure_time_V45', 'departure_time_V46', 'departure_time_V47', 'departure_time_V48', 'departure_time_V49', 'departure_time_V50', 'departure_time_V51', 'departure_time_V52', 'departure_time_V53', 'departure_time_V54', 'departure_time_V55', 'departure_time_V56', 'departure_time_V57', 'departure_time_V58', 'departure_time_V59', 'departure_time_V60', 'departure_time_V61', 'departure_time_V62', 'departure_time_V63', 'departure_time_V64', 'departure_time_V65', 'departure_time_V66', 'departure_time_V67', 'departure_time_V68', 'departure_time_V69', 'departure_time_V70', 'departure_time_V71', 'departure_time_V72', 'departure_time_V73', 'departure_time_V74', 'departure_time_V75', 'departure_time_V76'] not in index"

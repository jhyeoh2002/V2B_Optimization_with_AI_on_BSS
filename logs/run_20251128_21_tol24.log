Crash diagnostics ON


==================================================
PART 1: Data preprocess for 2023-01-01 00:00:00 to 2024-09-30 23:00:00...
==================================================

	1.1 Preprocessing radiation data...
		[INFO] Radiation data already exists at './data/timeseries/radiation_data.csv'

	1.2 Preprocessing temperature data...
		[INFO] Temperature data already exists at './data/timeseries/temperature_data.csv'

	1.3 Preprocessing building data...
		[INFO] Building data already exists at './data/timeseries/building_data.csv'

	1.4 Preprocessing electricity cost data...
		[INFO] Electricity cost data already exists at './data/timeseries/electricitycostG2B_data.csv' and './data/timeseries/electricitycostG2V_data.csv'

	1.5 Preprocessing battery demand series data...
		[INFO] Found existing battery data at './data/battery_demand/tol24/resample_full.csv' and './data/battery_demand/tol24/resample_train.csv'

		[INFO] Number of series for clean windows = (168, 37)
		[INFO] Number of eligible series for Case 2 = (1377, 37)
		[INFO] Number of seeds ready for Case 3  = (2000, 36)

		[INFO] Case 1 exists — loaded battery demand from './data/battery_demand/tol24/case1_real_only/battery_demand.npy' with shape (168, 37).
		[INFO] Case 2 exists — loaded battery demand from './data/battery_demand/tol24/case2_nan_filled/battery_demand.npy' with shape (1545, 37).
		[INFO] Case 3 exists — loaded battery demand from './data/battery_demand/tol24/case3_extended_generated/battery_demand.npy' with shape (3545, 37).
		[INFO] Case 0: Successfully added test pair 2024-03-15 & 2024-03-16
		Data: [10536, 28, 30, 35, 37, 37, 36, 33, 26, 10, 6, 10, 14, 19, 18, 15, 20, 26, 15, 9, 16, 21, 20, 8, 12, 15, 24, 31, 35, 32, 35, 34, 32, 31, 30, 22, 14, 18, 27, 18, 19, 19, 25, 25, 25, 26, 27, 17, 19]
		[INFO] Case 0: Successfully added test pair 2024-03-29 & 2024-03-30
		Data: [10872, 13, 26, 31, 33, 33, 33, 31, 15, 8, 19, 11, 15, 18, 16, 18, 18, 19, 7, 4, 23, 23, 16, 17, 18, 18, 19, 24, 29, 30, 30, 22, 27, 21, 14, 15, 16, 20, 18, 23, 27, 18, 2, 10, 23, 22, 22, 17, 21]

	1.6 Generating battery schedule...
		[INFO] Case 1 exists — loaded from './data/battery_demand/tol24/case1_real_only/battery_availability.npy' and './data/battery_demand/tol24/case1_real_only/battery_details.npy' shape (168, 263, 36) and (4, 168, 263)
		[INFO] Case 2 exists — loaded from './data/battery_demand/tol24/case2_nan_filled/battery_availability.npy' and './data/battery_demand/tol24/case2_nan_filled/battery_details.npy' shape (1545, 311, 36) and (4, 1545, 311)
		[INFO] Case 3 exists — loaded from './data/battery_demand/tol24/case3_extended_generated/battery_availability.npy' and './data/battery_demand/tol24/case3_extended_generated/battery_details.npy' shape (3545, 422, 36) and (4, 3545, 422)


==================================================
PART 2: MILP Optimization...
==================================================

	2.1 Optimizing Case 1...
		[INFO] Loaded 168 samples from './data/battery_demand/tol24/case1_real_only'
		[INFO] Results already exist at './data/optimization_results/tol24/case1_real_only/optimization/V2B.npy'. Skipping optimization run.
		[INFO] Results already exist at './data/optimization_results/tol24/case1_real_only/immediate_charging/V2B.npy'. Skipping immediate_charging run.
		[INFO] Case 1 completed.

	2.2 Optimizing Case 2...
		[INFO] Loaded 1545 samples from './data/battery_demand/tol24/case2_nan_filled'
		[INFO] Results already exist at './data/optimization_results/tol24/case2_nan_filled/optimization/V2B.npy'. Skipping optimization run.
		[INFO] Results already exist at './data/optimization_results/tol24/case2_nan_filled/immediate_charging/V2B.npy'. Skipping immediate_charging run.
		[INFO] Case 2 completed.

	2.3 Optimizing Case 3...
		[INFO] Loaded 3545 samples from './data/battery_demand/tol24/case3_extended_generated'
		[INFO] Results already exist at './data/optimization_results/tol24/case3_extended_generated/optimization/V2B.npy'. Skipping optimization run.
		[INFO] Results already exist at './data/optimization_results/tol24/case3_extended_generated/immediate_charging/V2B.npy'. Skipping immediate_charging run.
		[INFO] Case 3 completed.


==================================================
PART 3: Supervised Learning...
==================================================

	3.1 Training Case 1...
		=== Training Log Started: 2025-11-28 21:59:43.328204 ===
		Run Name: STAFV2_24_CASE1
		Device: cuda
		Epochs: 1000, Batch Size: 128, LR: 0.0005
		============================================================
		[INFO] Unique quantized indices: 6686
		[INFO] Suggested num_embeddings: 8023
		[INFO] Processed 168 valid samples.
		[INFO] Saved merged dataset: ./data/training_results/merged_windowed_dataset_STAFV2_24_CASE1.csv  (shape: (168, 429))
		[INFO] Saved feature metadata: ./data/training_results/feature_info_STAFV2_24_CASE1.json
		[INFO] Dataset split: 134 train, 34 val
		[INFO] Scalers fitted and saved.

		✅ Model initialized with 773476 params.
		============================================================
		--------------------------------------------------------------------------------------------
		  Epoch    |     LR     |  Train RMSE  |   Val RMSE   |  Train R²  |   Val R²   |  Patience 
		--------------------------------------------------------------------------------------------
		    1/1000 | 0.000500   |    9.95243   |    8.96800   |     -1.058 |     -0.908 |    0/150  
		    2/1000 | 0.000500   |    8.84055   |    8.84243   |     -0.971 |     -0.855 |    0/150  
		    3/1000 | 0.000500   |    8.93391   |    8.69200   |     -0.877 |     -0.792 |    0/150  
		    4/1000 | 0.000500   |    8.07536   |    8.54516   |     -0.801 |     -0.732 |    0/150  
		    5/1000 | 0.000500   |    7.15075   |    8.36823   |     -0.752 |     -0.661 |    0/150  
		    6/1000 | 0.000500   |    6.30785   |    8.18241   |     -0.660 |     -0.588 |    0/150  
		    7/1000 | 0.000500   |    8.39223   |    8.01404   |     -0.580 |     -0.524 |    0/150  
		    8/1000 | 0.000500   |    8.70734   |    7.83474   |     -0.535 |     -0.456 |    0/150  
		    9/1000 | 0.000500   |    9.50738   |    7.69057   |     -0.484 |     -0.403 |    0/150  
		   10/1000 | 0.000500   |    8.44582   |    7.52108   |     -0.402 |     -0.342 |    0/150  
		   11/1000 | 0.000500   |    5.44739   |    7.25473   |     -0.344 |     -0.249 |    0/150  
		   12/1000 | 0.000500   |    7.12815   |    7.04368   |     -0.298 |     -0.177 |    0/150  
		   13/1000 | 0.000500   |    5.42929   |    6.80047   |     -0.216 |     -0.097 |    0/150  
		   14/1000 | 0.000500   |    7.32650   |    6.66366   |     -0.150 |     -0.054 |    0/150  
		   15/1000 | 0.000500   |    7.79070   |    6.57729   |     -0.127 |     -0.026 |    0/150  
		   16/1000 | 0.000500   |    5.17537   |    6.27843   |     -0.090 |      0.065 |    0/150  
		   17/1000 | 0.000500   |    5.88263   |    6.08999   |      0.030 |      0.120 |    0/150  
		   18/1000 | 0.000500   |    7.08352   |    5.96793   |      0.064 |      0.155 |    0/150  
		   19/1000 | 0.000500   |    6.25289   |    5.83458   |      0.106 |      0.192 |    0/150  
		   20/1000 | 0.000500   |    5.63287   |    5.65348   |      0.146 |      0.242 |    0/150  
		   21/1000 | 0.000500   |    4.73203   |    5.41017   |      0.198 |      0.306 |    0/150  
		   22/1000 | 0.000500   |    5.05992   |    5.26461   |      0.243 |      0.342 |    0/150  
		   23/1000 | 0.000500   |    4.55377   |    4.99819   |      0.266 |      0.407 |    0/150  
		                                          ╚══> ✅ SAVED (RMSE: 4.9982)
		   24/1000 | 0.000500   |    4.81929   |    4.72579   |      0.323 |      0.470 |    0/150  
		                                          ╚══> ✅ SAVED (RMSE: 4.7258)
		   25/1000 | 0.000500   |    5.84403   |    4.70858   |      0.358 |      0.474 |    0/150  
		                                          ╚══> ✅ SAVED (RMSE: 4.7086)
		   26/1000 | 0.000500   |    4.95872   |    4.65388   |      0.405 |      0.486 |    0/150  
		                                          ╚══> ✅ SAVED (RMSE: 4.6539)
		   27/1000 | 0.000500   |    5.38886   |    4.59152   |      0.429 |      0.500 |    0/150  
		                                          ╚══> ✅ SAVED (RMSE: 4.5915)
		   28/1000 | 0.000500   |    5.06256   |    4.43548   |      0.457 |      0.533 |    0/150  
		                                          ╚══> ✅ SAVED (RMSE: 4.4355)
		   29/1000 | 0.000500   |    4.59838   |    4.46835   |      0.508 |      0.526 |    0/150  
		   30/1000 | 0.000500   |    4.39582   |    4.44909   |      0.535 |      0.530 |    1/150  
		   31/1000 | 0.000500   |    4.26451   |    4.35892   |      0.547 |      0.549 |    2/150  
		                                          ╚══> ✅ SAVED (RMSE: 4.3589)
		   32/1000 | 0.000500   |    4.74233   |    4.36363   |      0.566 |      0.548 |    0/150  
		   33/1000 | 0.000500   |    4.42777   |    4.31899   |      0.601 |      0.557 |    1/150  
		                                          ╚══> ✅ SAVED (RMSE: 4.3190)
		   34/1000 | 0.000500   |    3.77338   |    4.37082   |      0.621 |      0.547 |    0/150  
		   35/1000 | 0.000500   |    3.98509   |    4.38113   |      0.628 |      0.545 |    1/150  
		   36/1000 | 0.000500   |    3.28034   |    4.42798   |      0.665 |      0.535 |    2/150  
		   37/1000 | 0.000500   |    3.97132   |    4.45003   |      0.655 |      0.530 |    3/150  
		   38/1000 | 0.000500   |    3.44393   |    4.46108   |      0.672 |      0.528 |    4/150  
		   39/1000 | 0.000500   |    3.62666   |    4.48136   |      0.684 |      0.524 |    5/150  
		   40/1000 | 0.000500   |    3.79625   |    4.47470   |      0.679 |      0.525 |    6/150  
		   41/1000 | 0.000500   |    3.56350   |    4.49306   |      0.713 |      0.521 |    7/150  
		   42/1000 | 0.000500   |    3.44848   |    4.48045   |      0.695 |      0.524 |    8/150  
		   43/1000 | 0.000500   |    3.95130   |    4.52875   |      0.706 |      0.513 |    9/150  
		   44/1000 | 0.000500   |    3.21287   |    4.50606   |      0.740 |      0.518 |   10/150  
		   45/1000 | 0.000500   |    3.33439   |    4.51066   |      0.736 |      0.517 |   11/150  
		   46/1000 | 0.000500   |    3.66670   |    4.49640   |      0.756 |      0.520 |   12/150  
		   47/1000 | 0.000500   |    3.25493   |    4.47511   |      0.786 |      0.525 |   13/150  
		   48/1000 | 0.000500   |    2.70592   |    4.50094   |      0.772 |      0.519 |   14/150  
		   49/1000 | 0.000450   |    5.06759   |    4.64496   |      0.765 |      0.488 |   15/150  
		   50/1000 | 0.000450   |    3.07755   |    4.56978   |      0.776 |      0.505 |   16/150  
		   51/1000 | 0.000450   |    3.67014   |    4.64356   |      0.790 |      0.488 |   17/150  
		   52/1000 | 0.000450   |    2.72721   |    4.61346   |      0.800 |      0.495 |   18/150  
		   53/1000 | 0.000450   |    3.18940   |    4.60276   |      0.806 |      0.497 |   19/150  
		   54/1000 | 0.000450   |    2.36865   |    4.61365   |      0.823 |      0.495 |   20/150  
		   55/1000 | 0.000450   |    2.22803   |    4.60185   |      0.818 |      0.498 |   21/150  
		   56/1000 | 0.000450   |    3.55498   |    4.57159   |      0.812 |      0.504 |   22/150  
		   57/1000 | 0.000450   |    3.14861   |    4.65935   |      0.825 |      0.485 |   23/150  
		   58/1000 | 0.000450   |    3.16768   |    4.72219   |      0.825 |      0.471 |   24/150  
		   59/1000 | 0.000450   |    2.89046   |    4.67997   |      0.849 |      0.480 |   25/150  
		   60/1000 | 0.000450   |    3.41711   |    4.68320   |      0.846 |      0.480 |   26/150  
		   61/1000 | 0.000450   |    2.28055   |    4.72691   |      0.865 |      0.470 |   27/150  
		   62/1000 | 0.000450   |    1.91546   |    4.74284   |      0.875 |      0.466 |   28/150  
		   63/1000 | 0.000450   |    2.87153   |    4.74670   |      0.862 |      0.465 |   29/150  
		   64/1000 | 0.000450   |    2.09398   |    4.78728   |      0.889 |      0.456 |   30/150  
		   65/1000 | 0.000405   |    1.93736   |    4.83438   |      0.888 |      0.446 |   31/150  
		   66/1000 | 0.000405   |    1.98880   |    4.92559   |      0.889 |      0.424 |   32/150  
		   67/1000 | 0.000405   |    2.98038   |    4.95183   |      0.886 |      0.418 |   33/150  
		   68/1000 | 0.000405   |    2.96832   |    5.08935   |      0.909 |      0.385 |   34/150  
		   69/1000 | 0.000405   |    3.26792   |    5.21362   |      0.896 |      0.355 |   35/150  
		   70/1000 | 0.000405   |    1.68988   |    5.21585   |      0.910 |      0.355 |   36/150  
		   71/1000 | 0.000405   |    3.08523   |    5.34877   |      0.895 |      0.321 |   37/150  
		   72/1000 | 0.000405   |    2.09045   |    5.33326   |      0.908 |      0.325 |   38/150  
		   73/1000 | 0.000405   |    2.13816   |    5.26432   |      0.914 |      0.342 |   39/150  
		   74/1000 | 0.000405   |    1.93593   |    5.25102   |      0.922 |      0.346 |   40/150  
		   75/1000 | 0.000405   |    2.08196   |    5.31838   |      0.912 |      0.329 |   41/150  
		   76/1000 | 0.000405   |    2.24434   |    5.35418   |      0.927 |      0.320 |   42/150  
		   77/1000 | 0.000405   |    1.98706   |    5.40619   |      0.931 |      0.307 |   43/150  
		   78/1000 | 0.000405   |    1.93325   |    5.36863   |      0.921 |      0.316 |   44/150  
		   79/1000 | 0.000405   |    1.83085   |    5.41181   |      0.921 |      0.305 |   45/150  
		   80/1000 | 0.000405   |    1.97426   |    5.49828   |      0.935 |      0.283 |   46/150  
		   81/1000 | 0.000365   |    1.47955   |    5.44663   |      0.935 |      0.296 |   47/150  
		   82/1000 | 0.000365   |    4.13177   |    5.41518   |      0.895 |      0.304 |   48/150  
		   83/1000 | 0.000365   |    2.03346   |    5.50403   |      0.930 |      0.281 |   49/150  
		   84/1000 | 0.000365   |    2.06605   |    5.47815   |      0.933 |      0.288 |   50/150  
		   85/1000 | 0.000365   |    2.40839   |    5.54747   |      0.927 |      0.270 |   51/150  
		   86/1000 | 0.000365   |    2.47559   |    5.59742   |      0.931 |      0.257 |   52/150  
		   87/1000 | 0.000365   |    2.23579   |    5.55666   |      0.918 |      0.267 |   53/150  
		   88/1000 | 0.000365   |    2.98838   |    5.68172   |      0.931 |      0.234 |   54/150  
		   89/1000 | 0.000365   |    2.22118   |    5.62130   |      0.940 |      0.250 |   55/150  
		   90/1000 | 0.000365   |    1.57596   |    5.61225   |      0.942 |      0.253 |   56/150  
		   91/1000 | 0.000365   |    1.83548   |    5.66876   |      0.938 |      0.238 |   57/150  
		   92/1000 | 0.000365   |    2.67350   |    5.73264   |      0.931 |      0.220 |   58/150  
		   93/1000 | 0.000365   |    2.15659   |    5.58322   |      0.940 |      0.260 |   59/150  
		   94/1000 | 0.000365   |    1.61739   |    5.56427   |      0.941 |      0.265 |   60/150  
		   95/1000 | 0.000365   |    1.65397   |    5.53731   |      0.948 |      0.273 |   61/150  
		   96/1000 | 0.000365   |    2.51875   |    5.59203   |      0.943 |      0.258 |   62/150  
		   97/1000 | 0.000328   |    2.64094   |    5.54549   |      0.942 |      0.270 |   63/150  
		   98/1000 | 0.000328   |    1.89684   |    5.58000   |      0.944 |      0.261 |   64/150  
		   99/1000 | 0.000328   |    1.23999   |    5.55255   |      0.948 |      0.269 |   65/150  
		  100/1000 | 0.000328   |    1.47520   |    5.50554   |      0.949 |      0.281 |   66/150  
		  101/1000 | 0.000328   |    1.34121   |    5.52412   |      0.950 |      0.276 |   67/150  
		  102/1000 | 0.000328   |    1.76746   |    5.58428   |      0.951 |      0.260 |   68/150  
		  103/1000 | 0.000328   |    2.13105   |    5.51294   |      0.946 |      0.279 |   69/150  
		  104/1000 | 0.000328   |    2.31362   |    5.51132   |      0.939 |      0.279 |   70/150  
		  105/1000 | 0.000328   |    1.48516   |    5.53650   |      0.955 |      0.273 |   71/150  
		  106/1000 | 0.000328   |    2.36344   |    5.45143   |      0.951 |      0.295 |   72/150  
		  107/1000 | 0.000328   |    1.22394   |    5.49918   |      0.955 |      0.283 |   73/150  
		  108/1000 | 0.000328   |    2.57720   |    5.52705   |      0.947 |      0.275 |   74/150  
		  109/1000 | 0.000328   |    1.93143   |    5.56919   |      0.952 |      0.264 |   75/150  
		  110/1000 | 0.000328   |    1.65485   |    5.58707   |      0.948 |      0.259 |   76/150  
		  111/1000 | 0.000328   |    1.03528   |    5.57647   |      0.958 |      0.262 |   77/150  
		  112/1000 | 0.000328   |    1.82821   |    5.60008   |      0.955 |      0.256 |   78/150  
		  113/1000 | 0.000295   |    1.46576   |    5.65598   |      0.959 |      0.241 |   79/150  
		  114/1000 | 0.000295   |    3.54152   |    5.77422   |      0.938 |      0.209 |   80/150  
		  115/1000 | 0.000295   |    2.21993   |    5.80742   |      0.949 |      0.200 |   81/150  
		  116/1000 | 0.000295   |    1.64119   |    5.79644   |      0.959 |      0.203 |   82/150  
		  117/1000 | 0.000295   |    2.69512   |    5.65419   |      0.944 |      0.241 |   83/150  
		  118/1000 | 0.000295   |    1.35524   |    5.57455   |      0.960 |      0.263 |   84/150  
		  119/1000 | 0.000295   |    1.24737   |    5.57517   |      0.945 |      0.263 |   85/150  
		  120/1000 | 0.000295   |    2.01638   |    5.64076   |      0.947 |      0.245 |   86/150  
		  121/1000 | 0.000295   |    1.40428   |    5.68883   |      0.950 |      0.232 |   87/150  
		  122/1000 | 0.000295   |    1.88120   |    5.69496   |      0.951 |      0.231 |   88/150  
		  123/1000 | 0.000295   |    1.30391   |    5.69647   |      0.960 |      0.230 |   89/150  
		  124/1000 | 0.000295   |    1.83330   |    5.61935   |      0.951 |      0.251 |   90/150  
		  125/1000 | 0.000295   |    1.44075   |    5.63312   |      0.955 |      0.247 |   91/150  
		  126/1000 | 0.000295   |    1.95366   |    5.68318   |      0.943 |      0.234 |   92/150  
		  127/1000 | 0.000295   |    1.49732   |    5.68523   |      0.954 |      0.233 |   93/150  
		  128/1000 | 0.000295   |    1.84025   |    5.71268   |      0.942 |      0.226 |   94/150  
		  129/1000 | 0.000266   |    2.48206   |    5.62420   |      0.953 |      0.250 |   95/150  

Crash diagnostics ON


==================================================
PART 1: Data preprocess for 2023-01-01 00:00:00 to 2024-09-30 23:00:00...
==================================================

	1.1 Preprocessing radiation data...
		[INFO] Radiation data already exists at './data/timeseries/radiation_data.csv'

	1.2 Preprocessing temperature data...
		[INFO] Temperature data already exists at './data/timeseries/temperature_data.csv'

	1.3 Preprocessing building data...
		[INFO] Building data already exists at './data/timeseries/building_data.csv'

	1.4 Preprocessing electricity cost data...
		[INFO] Electricity cost data already exists at './data/timeseries/electricitycostG2B_data.csv' and './data/timeseries/electricitycostG2V_data.csv'

	1.5 Preprocessing battery demand series data...
		[INFO] Found existing battery data at './data/battery_demand/tol26/resample_full.csv' and './data/battery_demand/tol26/resample_train.csv'

		[INFO] Number of series for clean windows = (168, 37)
		[INFO] Number of eligible series for Case 2 = (1378, 37)
		[INFO] Number of seeds ready for Case 3  = (2000, 36)

		[INFO] Case 1 exists — loaded battery demand from './data/battery_demand/tol26/case1_real_only/battery_demand.npy' with shape (168, 37).
		[INFO] Case 2 exists — loaded battery demand from './data/battery_demand/tol26/case2_nan_filled/battery_demand.npy' with shape (1546, 37).
		[INFO] Case 3 exists — loaded battery demand from './data/battery_demand/tol26/case3_extended_generated/battery_demand.npy' with shape (3546, 37).
		[INFO] Case 0: Successfully added test pair 2024-03-15 & 2024-03-16
		Data: [10536, 28, 30, 35, 37, 37, 36, 33, 26, 10, 6, 10, 14, 19, 18, 15, 20, 26, 15, 9, 16, 21, 20, 8, 12, 15, 24, 31, 35, 32, 35, 34, 32, 31, 30, 22, 14, 18, 27, 18, 19, 19, 25, 25, 25, 26, 27, 17, 19]
		[INFO] Case 0: Successfully added test pair 2024-03-29 & 2024-03-30
		Data: [10872, 13, 26, 31, 33, 33, 33, 31, 15, 8, 19, 11, 15, 18, 16, 18, 18, 19, 7, 4, 23, 23, 16, 17, 18, 18, 19, 24, 29, 30, 30, 22, 27, 21, 14, 15, 16, 20, 18, 23, 27, 18, 2, 10, 23, 22, 22, 17, 21]

	1.6 Generating battery schedule...
		[INFO] Case 1 exists — loaded from './data/battery_demand/tol26/case1_real_only/battery_availability.npy' and './data/battery_demand/tol26/case1_real_only/battery_details.npy' shape (168, 263, 36) and (4, 168, 263)
		[INFO] Case 2 exists — loaded from './data/battery_demand/tol26/case2_nan_filled/battery_availability.npy' and './data/battery_demand/tol26/case2_nan_filled/battery_details.npy' shape (1546, 311, 36) and (4, 1546, 311)
		[INFO] Case 3 exists — loaded from './data/battery_demand/tol26/case3_extended_generated/battery_availability.npy' and './data/battery_demand/tol26/case3_extended_generated/battery_details.npy' shape (3546, 422, 36) and (4, 3546, 422)


==================================================
PART 2: MILP Optimization...
==================================================

	2.1 Optimizing Case 1...
		[INFO] Loaded 168 samples from './data/battery_demand/tol26/case1_real_only'
		[INFO] Results already exist at './data/optimization_results/tol26/case1_real_only/optimization/V2B.npy'. Skipping optimization run.
		[INFO] Results already exist at './data/optimization_results/tol26/case1_real_only/immediate_charging/V2B.npy'. Skipping immediate_charging run.
		[INFO] Case 1 completed.

	2.2 Optimizing Case 2...
		[INFO] Loaded 1546 samples from './data/battery_demand/tol26/case2_nan_filled'
		[INFO] Results already exist at './data/optimization_results/tol26/case2_nan_filled/optimization/V2B.npy'. Skipping optimization run.
		[INFO] Results already exist at './data/optimization_results/tol26/case2_nan_filled/immediate_charging/V2B.npy'. Skipping immediate_charging run.
		[INFO] Case 2 completed.

	2.3 Optimizing Case 3...
		[INFO] Loaded 3546 samples from './data/battery_demand/tol26/case3_extended_generated'
		[INFO] Results already exist at './data/optimization_results/tol26/case3_extended_generated/optimization/V2B.npy'. Skipping optimization run.
		[INFO] Results already exist at './data/optimization_results/tol26/case3_extended_generated/immediate_charging/V2B.npy'. Skipping immediate_charging run.
		[INFO] Case 3 completed.


==================================================
PART 3: Supervised Learning...
==================================================

	3.1 Training Case 1...
		=== Training Log Started: 2025-11-28 21:59:43.345037 ===
		Run Name: STAFV2_26_CASE1
		Device: cuda
		Epochs: 1000, Batch Size: 128, LR: 0.0005
		============================================================
		[INFO] Unique quantized indices: 6686
		[INFO] Suggested num_embeddings: 8023
		[INFO] Processed 168 valid samples.
		[INFO] Saved merged dataset: ./data/training_results/merged_windowed_dataset_STAFV2_26_CASE1.csv  (shape: (168, 429))
		[INFO] Saved feature metadata: ./data/training_results/feature_info_STAFV2_26_CASE1.json
		[INFO] Dataset split: 134 train, 34 val
		[INFO] Scalers fitted and saved.

		✅ Model initialized with 773476 params.
		============================================================
		--------------------------------------------------------------------------------------------
		  Epoch    |     LR     |  Train RMSE  |   Val RMSE   |  Train R²  |   Val R²   |  Patience 
		--------------------------------------------------------------------------------------------
		    1/1000 | 0.000500   |    9.28109   |    9.09753   |     -1.057 |     -0.977 |    0/150  
		    2/1000 | 0.000500   |    6.91753   |    8.98284   |     -0.970 |     -0.927 |    0/150  
		    3/1000 | 0.000500   |    8.91086   |    8.84758   |     -0.878 |     -0.870 |    0/150  
		    4/1000 | 0.000500   |    7.88406   |    8.72895   |     -0.798 |     -0.820 |    0/150  
		    5/1000 | 0.000500   |    7.08372   |    8.57257   |     -0.733 |     -0.755 |    0/150  
		    6/1000 | 0.000500   |    6.92331   |    8.38740   |     -0.655 |     -0.680 |    0/150  
		    7/1000 | 0.000500   |    8.34346   |    8.23996   |     -0.574 |     -0.622 |    0/150  
		    8/1000 | 0.000500   |    8.63889   |    8.07216   |     -0.514 |     -0.556 |    0/150  
		    9/1000 | 0.000500   |    9.81696   |    7.96850   |     -0.480 |     -0.516 |    0/150  
		   10/1000 | 0.000500   |    8.27988   |    7.82695   |     -0.396 |     -0.463 |    0/150  
		   11/1000 | 0.000500   |    5.54644   |    7.58805   |     -0.341 |     -0.375 |    0/150  
		   12/1000 | 0.000500   |    7.11415   |    7.37825   |     -0.267 |     -0.300 |    0/150  
		   13/1000 | 0.000500   |    5.35655   |    7.14422   |     -0.189 |     -0.219 |    0/150  
		   14/1000 | 0.000500   |    7.26326   |    6.99605   |     -0.154 |     -0.169 |    0/150  
		   15/1000 | 0.000500   |    8.01104   |    6.92403   |     -0.123 |     -0.145 |    0/150  
		   16/1000 | 0.000500   |    5.15488   |    6.62105   |     -0.076 |     -0.047 |    0/150  
		   17/1000 | 0.000500   |    6.10883   |    6.45353   |      0.038 |      0.005 |    0/150  
		   18/1000 | 0.000500   |    6.48141   |    6.32595   |      0.071 |      0.044 |    0/150  
		   19/1000 | 0.000500   |    6.16698   |    6.22136   |      0.107 |      0.076 |    0/150  
		   20/1000 | 0.000500   |    5.94808   |    6.02566   |      0.157 |      0.133 |    0/150  
		   21/1000 | 0.000500   |    5.42433   |    5.78037   |      0.227 |      0.202 |    0/150  
		   22/1000 | 0.000500   |    5.09969   |    5.72228   |      0.275 |      0.218 |    0/150  
		   23/1000 | 0.000500   |    4.73946   |    5.44894   |      0.277 |      0.291 |    0/150  
		   24/1000 | 0.000500   |    5.42235   |    5.21988   |      0.341 |      0.349 |    0/150  
		   25/1000 | 0.000500   |    5.38450   |    5.13027   |      0.384 |      0.371 |    0/150  
		   26/1000 | 0.000500   |    5.03499   |    5.01105   |      0.417 |      0.400 |    0/150  
		                                          ╚══> ✅ SAVED (RMSE: 5.0111)
		   27/1000 | 0.000500   |    4.90801   |    4.96369   |      0.466 |      0.412 |    0/150  
		                                          ╚══> ✅ SAVED (RMSE: 4.9637)
		   28/1000 | 0.000500   |    4.29382   |    4.75479   |      0.474 |      0.460 |    0/150  
		                                          ╚══> ✅ SAVED (RMSE: 4.7548)
		   29/1000 | 0.000500   |    4.46780   |    4.79881   |      0.536 |      0.450 |    0/150  
		   30/1000 | 0.000500   |    3.76378   |    4.76721   |      0.566 |      0.457 |    1/150  
		   31/1000 | 0.000500   |    4.10344   |    4.64621   |      0.582 |      0.484 |    2/150  
		                                          ╚══> ✅ SAVED (RMSE: 4.6462)
		   32/1000 | 0.000500   |    4.83734   |    4.67118   |      0.597 |      0.479 |    0/150  
		   33/1000 | 0.000500   |    4.55297   |    4.61886   |      0.614 |      0.490 |    1/150  
		                                          ╚══> ✅ SAVED (RMSE: 4.6189)
		   34/1000 | 0.000500   |    3.82220   |    4.73337   |      0.645 |      0.465 |    0/150  
		   35/1000 | 0.000500   |    3.55192   |    4.75293   |      0.639 |      0.460 |    1/150  
		   36/1000 | 0.000500   |    3.83436   |    4.77818   |      0.661 |      0.455 |    2/150  
		   37/1000 | 0.000500   |    3.89360   |    4.84184   |      0.669 |      0.440 |    3/150  
		   38/1000 | 0.000500   |    3.46191   |    4.86971   |      0.682 |      0.434 |    4/150  
		   39/1000 | 0.000500   |    3.74674   |    4.92285   |      0.673 |      0.421 |    5/150  
		   40/1000 | 0.000500   |    3.33291   |    4.95311   |      0.696 |      0.414 |    6/150  
		   41/1000 | 0.000500   |    3.46883   |    4.96551   |      0.715 |      0.411 |    7/150  
		   42/1000 | 0.000500   |    3.81130   |    5.00205   |      0.695 |      0.402 |    8/150  
		   43/1000 | 0.000500   |    4.32405   |    4.97675   |      0.712 |      0.408 |    9/150  
		   44/1000 | 0.000500   |    3.44571   |    4.94919   |      0.734 |      0.415 |   10/150  
		   45/1000 | 0.000500   |    3.24618   |    4.92674   |      0.726 |      0.420 |   11/150  
		   46/1000 | 0.000500   |    3.47708   |    4.91843   |      0.758 |      0.422 |   12/150  
		   47/1000 | 0.000500   |    3.87517   |    4.84857   |      0.750 |      0.439 |   13/150  
		   48/1000 | 0.000500   |    2.88019   |    4.76728   |      0.767 |      0.457 |   14/150  
		   49/1000 | 0.000450   |    4.63690   |    4.67554   |      0.754 |      0.478 |   15/150  
		   50/1000 | 0.000450   |    3.31296   |    4.66289   |      0.784 |      0.481 |   16/150  
		   51/1000 | 0.000450   |    3.65595   |    4.61187   |      0.764 |      0.492 |   17/150  
		                                          ╚══> ✅ SAVED (RMSE: 4.6119)
		   52/1000 | 0.000450   |    3.28876   |    4.61520   |      0.791 |      0.491 |    0/150  
		   53/1000 | 0.000450   |    2.95010   |    4.60540   |      0.794 |      0.493 |    1/150  
		                                          ╚══> ✅ SAVED (RMSE: 4.6054)
		   54/1000 | 0.000450   |    2.59762   |    4.56704   |      0.801 |      0.502 |    0/150  
		                                          ╚══> ✅ SAVED (RMSE: 4.5670)
		   55/1000 | 0.000450   |    2.32298   |    4.54748   |      0.796 |      0.506 |    0/150  
		                                          ╚══> ✅ SAVED (RMSE: 4.5475)
		   56/1000 | 0.000450   |    3.53485   |    4.58566   |      0.807 |      0.498 |    0/150  
		   57/1000 | 0.000450   |    3.26464   |    4.53709   |      0.821 |      0.508 |    1/150  
		                                          ╚══> ✅ SAVED (RMSE: 4.5371)
		   58/1000 | 0.000450   |    2.80303   |    4.51264   |      0.812 |      0.514 |    0/150  
		                                          ╚══> ✅ SAVED (RMSE: 4.5126)
		   59/1000 | 0.000450   |    2.51304   |    4.51176   |      0.834 |      0.514 |    0/150  
		                                          ╚══> ✅ SAVED (RMSE: 4.5118)
		   60/1000 | 0.000450   |    3.39020   |    4.51629   |      0.829 |      0.513 |    0/150  
		   61/1000 | 0.000450   |    2.28035   |    4.54146   |      0.853 |      0.507 |    1/150  
		   62/1000 | 0.000450   |    1.89395   |    4.56936   |      0.861 |      0.501 |    2/150  
		   63/1000 | 0.000450   |    2.28423   |    4.61193   |      0.862 |      0.492 |    3/150  
		   64/1000 | 0.000450   |    1.94176   |    4.64352   |      0.862 |      0.485 |    4/150  
		   65/1000 | 0.000450   |    2.28432   |    4.69102   |      0.877 |      0.474 |    5/150  
		   66/1000 | 0.000450   |    2.11189   |    4.65328   |      0.863 |      0.483 |    6/150  
		   67/1000 | 0.000450   |    2.87685   |    4.67378   |      0.876 |      0.478 |    7/150  
		   68/1000 | 0.000450   |    3.11024   |    4.64160   |      0.882 |      0.485 |    8/150  
		   69/1000 | 0.000450   |    4.02126   |    4.66622   |      0.859 |      0.480 |    9/150  
		   70/1000 | 0.000450   |    2.16209   |    4.70596   |      0.884 |      0.471 |   10/150  
		   71/1000 | 0.000450   |    3.03012   |    4.71256   |      0.877 |      0.470 |   11/150  
		   72/1000 | 0.000450   |    2.04250   |    4.74516   |      0.878 |      0.462 |   12/150  
		   73/1000 | 0.000450   |    1.88539   |    4.74887   |      0.891 |      0.461 |   13/150  
		   74/1000 | 0.000450   |    1.90271   |    4.76839   |      0.881 |      0.457 |   14/150  
		   75/1000 | 0.000405   |    3.00091   |    4.81101   |      0.879 |      0.447 |   15/150  
		   76/1000 | 0.000405   |    1.61651   |    4.85768   |      0.913 |      0.436 |   16/150  
		   77/1000 | 0.000405   |    2.19834   |    4.90393   |      0.902 |      0.426 |   17/150  
		   78/1000 | 0.000405   |    2.64411   |    4.93525   |      0.912 |      0.418 |   18/150  
		   79/1000 | 0.000405   |    1.87737   |    4.97111   |      0.901 |      0.410 |   19/150  
		   80/1000 | 0.000405   |    2.92625   |    5.00440   |      0.907 |      0.402 |   20/150  
		   81/1000 | 0.000405   |    2.03930   |    5.03689   |      0.917 |      0.394 |   21/150  
		   82/1000 | 0.000405   |    2.44264   |    5.07439   |      0.906 |      0.385 |   22/150  
		   83/1000 | 0.000405   |    2.31430   |    5.06857   |      0.914 |      0.386 |   23/150  
		   84/1000 | 0.000405   |    2.98719   |    5.08106   |      0.911 |      0.383 |   24/150  
		   85/1000 | 0.000405   |    1.96875   |    5.07959   |      0.928 |      0.384 |   25/150  
		   86/1000 | 0.000405   |    1.46368   |    5.07899   |      0.928 |      0.384 |   26/150  
		   87/1000 | 0.000405   |    2.05247   |    5.10025   |      0.919 |      0.379 |   27/150  
		   88/1000 | 0.000405   |    1.80873   |    5.08547   |      0.925 |      0.382 |   28/150  
		   89/1000 | 0.000405   |    2.53955   |    5.08663   |      0.938 |      0.382 |   29/150  
		   90/1000 | 0.000405   |    1.70019   |    5.10020   |      0.927 |      0.379 |   30/150  
		   91/1000 | 0.000365   |    1.57532   |    5.10266   |      0.939 |      0.378 |   31/150  
		   92/1000 | 0.000365   |    1.65054   |    5.14473   |      0.938 |      0.368 |   32/150  
		   93/1000 | 0.000365   |    2.49240   |    5.15030   |      0.932 |      0.367 |   33/150  
		   94/1000 | 0.000365   |    2.05684   |    5.15469   |      0.942 |      0.365 |   34/150  
		   95/1000 | 0.000365   |    2.58736   |    5.17942   |      0.926 |      0.359 |   35/150  
		   96/1000 | 0.000365   |    2.54356   |    5.16255   |      0.939 |      0.363 |   36/150  
		   97/1000 | 0.000365   |    2.20322   |    5.20639   |      0.948 |      0.353 |   37/150  
		   98/1000 | 0.000365   |    2.25999   |    5.17679   |      0.938 |      0.360 |   38/150  
		   99/1000 | 0.000365   |    1.79803   |    5.17759   |      0.943 |      0.360 |   39/150  
		  100/1000 | 0.000365   |    1.85945   |    5.16532   |      0.948 |      0.363 |   40/150  
		  101/1000 | 0.000365   |    1.89110   |    5.18110   |      0.945 |      0.359 |   41/150  
		  102/1000 | 0.000365   |    1.78214   |    5.15723   |      0.948 |      0.365 |   42/150  
		  103/1000 | 0.000365   |    1.92768   |    5.16967   |      0.939 |      0.362 |   43/150  
		  104/1000 | 0.000365   |    2.27995   |    5.18892   |      0.938 |      0.357 |   44/150  
		  105/1000 | 0.000365   |    1.56308   |    5.17170   |      0.948 |      0.361 |   45/150  
		  106/1000 | 0.000365   |    2.50283   |    5.16767   |      0.946 |      0.362 |   46/150  
		  107/1000 | 0.000328   |    2.58373   |    5.12384   |      0.936 |      0.373 |   47/150  
		  108/1000 | 0.000328   |    2.80511   |    5.11520   |      0.944 |      0.375 |   48/150  
		  109/1000 | 0.000328   |    3.52739   |    5.13529   |      0.920 |      0.370 |   49/150  
		  110/1000 | 0.000328   |    1.87961   |    5.11696   |      0.942 |      0.375 |   50/150  
		  111/1000 | 0.000328   |    1.70516   |    5.11882   |      0.952 |      0.374 |   51/150  
		  112/1000 | 0.000328   |    1.75994   |    5.14520   |      0.949 |      0.368 |   52/150  
		  113/1000 | 0.000328   |    1.11322   |    5.15496   |      0.957 |      0.365 |   53/150  
		  114/1000 | 0.000328   |    3.01287   |    5.13445   |      0.937 |      0.370 |   54/150  
		  115/1000 | 0.000328   |    1.88528   |    5.09163   |      0.946 |      0.381 |   55/150  
		  116/1000 | 0.000328   |    1.84039   |    5.09300   |      0.949 |      0.381 |   56/150  
		  117/1000 | 0.000328   |    3.34213   |    5.11229   |      0.938 |      0.376 |   57/150  
		  118/1000 | 0.000328   |    1.50482   |    5.11699   |      0.947 |      0.375 |   58/150  
		  119/1000 | 0.000328   |    1.70474   |    5.13058   |      0.938 |      0.371 |   59/150  
		  120/1000 | 0.000328   |    2.69305   |    5.09195   |      0.917 |      0.381 |   60/150  
		  121/1000 | 0.000328   |    1.95319   |    5.08381   |      0.945 |      0.383 |   61/150  
		  122/1000 | 0.000328   |    1.56000   |    5.10641   |      0.944 |      0.377 |   62/150  
		  123/1000 | 0.000295   |    1.47661   |    5.10598   |      0.955 |      0.377 |   63/150  
		  124/1000 | 0.000295   |    2.08774   |    5.12077   |      0.947 |      0.374 |   64/150  
		  125/1000 | 0.000295   |    1.77847   |    5.12875   |      0.943 |      0.372 |   65/150  
		  126/1000 | 0.000295   |    1.55882   |    5.12652   |      0.951 |      0.372 |   66/150  
		  127/1000 | 0.000295   |    1.47708   |    5.14025   |      0.944 |      0.369 |   67/150  
		  128/1000 | 0.000295   |    1.85495   |    5.15706   |      0.944 |      0.365 |   68/150  
		  129/1000 | 0.000295   |    2.47916   |    5.20019   |      0.949 |      0.354 |   69/150  
		  130/1000 | 0.000295   |    3.41754   |    5.27494   |      0.949 |      0.335 |   70/150  
